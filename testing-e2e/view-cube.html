<!DOCTYPE html>
<html>
  <head>
    <title>Zea UX</title>
    <style>
      html,
      body,
      #canvas {
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
      }
      #view-cube {
        position: absolute;
        top: 8px;
        right: 8px;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>

    <script src="../node_modules/@zeainc/zea-engine/dist/index.umd.js"></script>
    <script src="../dist/index.umd.js"></script>

    <script>
      const {
        GLRenderer,
        Scene,
        Vec3,
        Xfo,
        Quat,
        EulerAngles,
        Color,
        AssetItem,
        Cylinder,
        Material,
        GeomItem,
        NumberParameter,
        TreeItem,
        Cuboid,
        Torus,
        CameraManipulator,
      } = window.zeaEngine
      const { ViewCube, AxisTripod } = window.zeaUx
      const domElement = document.getElementById('canvas')

      const scene = new Scene()
      scene.setupGrid(10, 10)
      const color = new Color('#E5E5E5')

      const renderer = new GLRenderer(domElement, { hideSplash: true })
      renderer.getViewport().backgroundColorParam.value = color
      renderer.setScene(scene)

      renderer.getViewport().getCamera().setPositionAndTarget(new Vec3(3, 3, 1.7), new Vec3(0, 0, 0))

      const viewCube = new ViewCube()
      viewCube.bindToViewport(renderer, renderer.getViewport())
      // scene.getRoot().addChild(viewCube)

      const manipulator = renderer.getViewport().getManipulator()
      manipulator.setDefaultManipulationMode(CameraManipulator.MANIPULATION_MODES.turntable)
      // manipulator.setDefaultManipulationMode(CameraManipulator.MANIPULATION_MODES.tumbler)

      renderer.getViewport().on('keyDown', (event) => {
        if (event.key == 'f') renderer.frameAll()
      })

      // ///////////////////////
      // Setup Scene

      const axisTripod = new AxisTripod(0.5)
      axisTripod.bindToViewport(renderer, renderer.getViewport(), 200, [-1, -1])
      // scene.getRoot().addChild(axisTripod)

      const material1 = new Material('material1', 'SimpleSurfaceShader')
      material1.getParameter('BaseColor').setValue(new Color('#94C47D'))

      const geomItem1 = new GeomItem('CuboidGeometryItem', new Cuboid(0.7, 0.7, 0.7), material1)

      const geomItem1Xfo = new Xfo()
      geomItem1Xfo.tr = new Vec3(1, 1, 1)
      geomItem1.getParameter('GlobalXfo').setValue(geomItem1Xfo)

      scene.getRoot().addChild(geomItem1)

      const material2 = new Material('material2', 'SimpleSurfaceShader')
      material2.getParameter('BaseColor').setValue(new Color('#35257D'))

      const geomItem2 = new GeomItem('TorusGeometryItem', new Torus(0.15, 0.5), material2)

      const geomItem2Xfo = new Xfo()
      geomItem2Xfo.tr = new Vec3(-1, 0, 0.35)
      geomItem2.getParameter('GlobalXfo').setValue(geomItem2Xfo)

      scene.getRoot().addChild(geomItem2)

      // {{{ Messages handler.
      const handleMessage = (event) => {
        const { data } = event

        if (data === 'front') {
          renderer.getViewport().getCamera().setPositionAndTarget(new Vec3(1, 1, 1.7), new Vec3(0, 0, 0))
          window.postMessage(`done-${data}`)
        } else if (data === 'back') {
          renderer.getViewport().getCamera().setPositionAndTarget(new Vec3(-1, -1, 1.7), new Vec3(0, 0, 0))
          window.postMessage(`done-${data}`)
        }
      }

      window.addEventListener('message', handleMessage, false)
      // }}}
    </script>
  </body>
</html>
